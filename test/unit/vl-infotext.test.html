<!doctype html>
<html>

<head>
  <meta charset="utf-8">
  <script src="../../../@webcomponents/webcomponentsjs/webcomponents-lite.js"></script>
  <script src="../../../web-component-tester/browser.js"></script>

  <script type="module" src="../../vl-infotext.src.js"></script>
</head>

<body>
  <test-fixture id="vl-infotext-fixture-leeg">
    <template>
      <div is='vl-infotext'></div>
    </template>
  </test-fixture>

  <test-fixture id="vl-infotext-fixture-meerdere-directe-children">
    <template>
      <div is='vl-infotext'>
        <div></div>
        <a></a>
      </div>
    </template>
  </test-fixture>

  <test-fixture id="vl-infotext-met-inhoud-fixture">
    <template>
      <div is='vl-infotext'>
        <div>
          <div data-vl-value>3200</div>
          <div data-vl-text>Bezoekers per dag</div>
        </div>
      </div>
    </template>
  </test-fixture>

  <test-fixture id="vl-infotext-met-link-fixture">
    <template>
      <div is='vl-infotext'>
        <a href="#">
          <div data-vl-value>3200</div>
          <div data-vl-text>Bezoekers per dag</div>
        </a>
      </div>
    </template>
  </test-fixture>

  <test-fixture id="vl-infotext-met-badge-fixture">
    <template>
      <div is='vl-infotext' data-vl-badge>
        <div>
          <div data-vl-value>3200</div>
          <div data-vl-text>Bezoekers per dag</div>
        </div>
      </div>
    </template>
  </test-fixture>

  <test-fixture id="vl-infotext-met-badge-en-link-fixture">
    <template>
      <div is='vl-infotext' data-vl-badge>
        <a href="#">
          <div data-vl-value>3200</div>
          <div data-vl-text>Bezoekers per dag</div>
        </a>
      </div>
    </template>
  </test-fixture>

  <script>
    suite('vl-infotext', () => {
      const should = chai.should();
      var sandbox = sinon.sandbox.create();

      setup(() => {
         sandbox.stub(console, 'warn');
      });

      teardown(() => {
        sandbox.restore();
      });

      test('Er kan geen lege infotext component gemaakt worden.', () => {
        const infotext = fixture('vl-infotext-fixture-leeg');
        voorEenOngeldigeComponentWordtEenWarningGetoond(infotext);
      });
      
      test('Er kan geen infotext component maken als die meerdere directe kinderen heeft.', () => {
        const infotext = fixture('vl-infotext-fixture-meerdere-directe-children');
        voorEenOngeldigeComponentWordtEenWarningGetoond(infotext);
      });
      
      function voorEenOngeldigeComponentWordtEenWarningGetoond(infotext) {
        expect(infotext.classList.contains('vl-infotext-wrapper')).to.not.be.true;
        expect( console.warn.calledOnce ).to.be.true;
        expect( console.warn.calledWith('De infotext component mag slechts 1 child hebben (<div> of <a>)') ).to.be.true;
      }
      
      test('De inhoud van de infotext component wordt correct opgebouwd', () => {
        const infotext = fixture('vl-infotext-met-inhoud-fixture');

        expect(infotext.querySelector('div.vl-infotext')).to.not.be.null;
        expect(infotext.__valueElement).to.not.be.null;
        expect(infotext.__textElement).to.not.be.null;
      });

      test('De inhoud van de infotext met een link wordt correct opgebouwd', () => {
        const infotext = fixture('vl-infotext-met-link-fixture');
        expect(infotext.querySelector('a.vl-infotext')).to.not.be.null;
        expect(infotext.__valueElement).to.not.be.null;
        expect(infotext.__textElement).to.not.be.null;
      });


      test('Een infotext met data-vl-badge attribuut wordt correct opgebouwd', () => {
        const infotext = fixture('vl-infotext-met-badge-fixture');

        expect(infotext.querySelector('div.vl-infotext--badge')).to.not.be.null;
        expect(infotext.__valueElement).to.not.be.null;
        expect(infotext.__textElement).to.not.be.null;
      });

      test('Van een infotext zonder data-vl-badge attribuut wordt geen badge gemaakt', () => {
        const infotext = fixture('vl-infotext-met-inhoud-fixture');
        expect(infotext.querySelector('div.vl-infotext--badge')).to.be.null;
      });

      test('Een infotext met data-vl-badge attribuut en link wordt correct opgebouwd', () => {
        const infotext = fixture('vl-infotext-met-badge-en-link-fixture');

        expect(infotext.querySelector('a.vl-infotext--badge')).to.not.be.null;
        expect(infotext.__valueElement).to.not.be.null;
        expect(infotext.__textElement).to.not.be.null;
      });

      test('Van een infotext met link zonder data-vl-badge attribuut wordt geen badge gemaakt', () => {
        const infotext = fixture('vl-infotext-met-link-fixture');
        expect(infotext.querySelector('a.vl-infotext--badge')).to.be.null;
      });

      test('Aan een infotext met inhoud kan het data-vl-badge attribuut worden toegevoegd en verwijderd', () => {
        let infotext = fixture('vl-infotext-met-inhoud-fixture');
        infotext.setAttribute('data-vl-badge', '');
        expect(infotext.querySelector('div.vl-infotext--badge')).to.not.be.null;
        infotext.removeAttribute('data-vl-badge');
        expect(infotext.querySelector('div.vl-infotext--badge')).to.be.null;

        infotext.setAttribute('data-vl-badge', 'true');
        expect(infotext.querySelector('div.vl-infotext--badge')).to.not.be.null;
        infotext.setAttribute('data-vl-badge', 'false');
        expect(infotext.querySelector('div.vl-infotext--badge')).to.be.null;

        infotext = fixture('vl-infotext-met-inhoud-fixture')
        infotext.setAttribute('data-vl-badge', 'false');
        expect(infotext.querySelector('div.vl-infotext--badge')).to.be.null;
      });

      test('Aan een infotext met link kan het data-vl-badge attribuut worden toegevoegd en verwijderd', () => {
        let infotext = fixture('vl-infotext-met-link-fixture');

        infotext.setAttribute('data-vl-badge', '');
        expect(infotext.querySelector('a.vl-infotext--badge')).to.not.be.null;
        infotext.removeAttribute('data-vl-badge');
        expect(infotext.querySelector('a.vl-infotext--badge')).to.be.null;

        infotext.setAttribute('data-vl-badge', 'true');
        expect(infotext.querySelector('a.vl-infotext--badge')).to.not.be.null;
        infotext.setAttribute('data-vl-badge', 'false');
        expect(infotext.querySelector('a.vl-infotext--badge')).to.be.null;

        infotext = fixture('vl-infotext-met-inhoud-fixture')
        infotext.setAttribute('data-vl-badge', 'false');
        expect(infotext.querySelector('a.vl-infotext--badge')).to.be.null;

      });
    });

  </script>
</body>

</html>
